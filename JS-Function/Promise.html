<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Promise</title>
</head>
<body>
    <h3>Promise</h3>

    <script>
        /**
         * JavaScript Demo: Promise Constructor
         * new Promise(executor)
         * executor是带有 resolve 和 reject 两个参数的函数
         * 等价于 new Promise( function(resolve, reject) {...} )
         * 
         * Promise构造函数执行时立即调用executor 函数，resolve 和 reject 两个函数作为参数传递给executor
         * ( executor函数在Promise构造函数返回新建对象前被调用)
         * resolve 和 reject 函数被调用时，分别将 promise 的状态改为 fulfilled (完成) 或 rejected (失败)
         * executor 内部通常会执行一些异步操作，一旦完成，可以调用resolve函数来将promise状态改成fulfilled，或者在发生错误时将它的状态改为rejected。
         * 
         * Promise.length
            length属性，其值总是为 1 (构造器参数的数目).

         * Promise.prototype
            表示 Promise 构造器的原型.
         * 
         */
        var promise1 = new Promise((resolve, reject) => { // reslove 是成功的回调函数，reject 是失败的回调函数
            // 当异步代码执行成功时，我们才会调用resolve(...), 当异步代码失败时就会调用reject(...)
            // Promise构造函数接受一个函数作为参数，该函数的两个参数分别是resolve和reject。它们是两个函数，由 JavaScript 引擎提供，不用自己部署。
            setTimeout(function () {
                resolve('成功！'); // 代码正常执行！
            }, 500)
        })

        promise1.then((value) => {
            console.log(value); // 打印："foo"
        }).catch((err) => {
            console.log(err);
        })
        console.log(promise1); // Promise 对象

        const promise = new Promise(function(resolve, reject) {
            // ... some code
            if ('异步操作成功'){
                resolve(value);
            } else {
                reject(error);
            }
        });

        // 用 Promise 对象来实现 Ajax 操作的例子
        /*
        const getJSON = function (url) {
            const promise11 = new Promise((resolve, reject) => {
                const handler = function () {
                    if (this.readyState !== 4) {
                        return;
                    }
                    if (this.status === 200) {
                        resolve(this.response);
                    } else {
                        reject(new Error(this.statusText));
                    }
                }
                const client = new XMLHttpRequest();
                client.open('GET', url);
                client.onreadystatechange = handler;
                client.responseType = 'json';
                client.setRequestHeader('Accept', 'application/json');
                client.send();
            })
            return promise11;
        }
        getJSON('/posts.json').then((res) => {
            console.log(res);
        }).catch((err) => {
            console.log(err + '访问错误！')
        })
        */
        /**
         * 上面代码中，getJSON是对 XMLHttpRequest 对象的封装，用于发出一个针对 JSON 数据的 HTTP 请求，并且返回一个Promise对象。
         * 需要注意的是，在getJSON内部，resolve函数和reject函数调用时，都带有参数。
        */
    </script>
</body>
</html>